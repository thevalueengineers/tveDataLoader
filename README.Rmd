---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(tveDataLoader)
library(tibble)
```

# tveDataLoader

<!-- badges: start -->
[![R-CMD-check](https://github.com/thevalueengineers/tveDataLoader/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/thevalueengineers/tveDataLoader/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/gh/thevalueengineers/tveDataLoader/graph/badge.svg?token=31TXY5ABMX)](https://codecov.io/gh/thevalueengineers/tveDataLoader)
<!-- badges: end -->

Load spss .sav data and perform basic data checks in a TVE manner.

## Installation

Install from github:

``` {r eval=FALSE}
renv::install("thevalueengineers/tveDataLoader")
```

## Example

`tve_path` converts paths to egnyte between Windows and MacOS formats.

``` {r}
# Run on MacOS:
tve_path("Z:/shared/TVE Data/1. Client Projects/")
```

### Loading SPSS Data

The package provides enhanced functionality for loading SPSS (.sav) files through the `load_sav()` function. This function not only loads the data but also extracts and organizes variable and value labels, making it easier to work with SPSS metadata.

```{r example, eval=FALSE}
library(tveDataLoader)

# Load SPSS data with metadata extraction
loaded_data <- load_sav(
  paste0(
    tve_path(path_to_file),
    "filename.sav"
  )
)

# The loaded_data object is a list containing:
# - loaded_data$loaded_data: The actual dataset
# - loaded_data$var_labels: Variable labels
# - loaded_data$val_labels: Value labels
# - loaded_data$no_var_labels: Variables without variable labels
# - loaded_data$no_val_labels: Variables without value labels
```

> Note: The older `read_sav()` function has been superseded by `load_sav()` which provides enhanced functionality for handling SPSS data and metadata.

### Data Checks

`run_data_checks` performs basic data checks and exploration on your data.

``` {r}
tibble::tibble(
  respid = 1:10,
  weight = rep(1, 10),
  q1 = sample(1:5, 10, replace = TRUE)
) |> 
  run_data_checks()
```

### Updating Labels

Use `update_var_labels` and `update_val_labels` to change variable and value labels respectively.

```{r}
nresps <- 5
dat <- tibble(
  var1 = sample(1:3, nresps, replace = TRUE),
  var2 = sample(0:1, nresps, replace = TRUE)
)

new_var_labels <- tribble(
  ~variable, ~value,
  "var1", "Variable 1",
  "var2", "Variable 2"
)

new_val_labels <- tribble(
  ~variable, ~value, ~`value label`,
  "var1", 1, "value 1",
  "var1", 2, "value 2",
  "var1", 3, "value 3",
  "var2", 0, "no",
  "var2", 1, "yes"
)

dat |> 
  update_var_labels(new_var_labels) |> 
  update_val_labels(new_val_labels)
```
